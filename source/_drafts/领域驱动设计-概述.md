---
title: 领域驱动设计_概述
tags: DDD
categories: 设计思想
---

# DDD入门
软件开发的目标：创造一个可测试、可伸缩、组织良好的软件模型。
DDD同时提供了战略（Strategic）上和战术（Tactical）上的建模工具来帮助我们设计高质量的软件模型。

>领域模型是关于特定业务领域的软件模型。通常领域模型通过对象模型来实现，对象同时包含了数据和行为，并且表达了准确的业务含义。

## 为什么需要DDD
DRY（Don't repeat yourself）原则：不要做重复的事情。
1. 使领域专家和开发人员在一起工作，使开发出来的软件能够准确地传达业务规则。
2. 帮助业务自我提高，没有人能保证对业务了如指掌，通过这个过程可以使得软对业务能力提升，大家即在学习又在贡献知识。
3. “准确地传达业务规则”的意思就像编码人员即是业务专家，业务专家就是编码人员。设计就是代码、代码就是设计。
4. DDD战略设计帮助我们理解哪些投入是最重要的，哪些资产是可以重复利用的，哪些人员应加入团队中。
5. DDD战术设计帮助我们创建DDD模型中各个部件。

DDD和敏捷开发是可以相互相成的，但又不太一样，DDD通过战略设计和战术设计在前期投入了不少精力，但得到的也是高回报：更加精确易懂的领域模型，通过DDD可以简化复杂的业务逻辑。

对于软件开发者应对业务有充分的认知，简单业务场景可直接使用CRUD进行开发，但当业务场景达到一定的复杂后，软件开发人员会发现系统运维越来越难，运维成本越来越高。

### 贫血症和失忆症
你是否存在过不记得这段代码的意图是什么，花了很长时间才明白回忆起来或者根本无法去回溯了，这种情况因为代码逻辑已和业务场景脱轨了，无法映射起来。
贫血症是指贫血领域对象缺少了其业务行为：
（1）方法的业务意图不明确。
（2）方法的实现本身增加了潜在的复杂性。
（3）领域对象变成了数据持有器（DAO），CRUD开发模式。
导致的影响就是失忆症，这种情况也称为“由贫血症导致的失忆症”。

## 如何DDD
DDD最具威力的特性之一：通用语言（UL，Ubiquitous Language）。
通用语言与限界上下文（BC，Bounded Context）是相辅相成的，构成了DDD的量大支柱。

团队在限界上下文下进行工作，使用通用语言进行交流。通用语言是团队业务范围下的描述，包含名称、形容词、动词、副词。通用语言是存在于限界上下文下，在不同的限界上下文下通用语言可能会存在不同的意义。


# 领域（Domain）
首先要明确什么是领域。通俗来讲，领域就是一个组织所做的事情及其中所包含的一切。

## 子域（Subdoamin）
由于领域承担了太多业务，业务越复杂领域模型就会越大，所以我们会把领域进行拆分为若干的子域。
通过战略设计可以让我们识别领域中最具价值和竞争力的模块（企业的Domain IP），这个模块我们称之为**核心域**，也是我们需要重点关注，投入大量成本的模块。
通过对核心域的分析我们又可以得到**支撑子域**，通过支撑域的支撑保障我们核心域的成功。
如果某个支撑域被用于整个业务系统，这个便是**通用子域**。

## 领域拆分
在问题空间中我们思考业务所面临的挑战，在解决方案空间中，我们思考如何通过实现软件以解决这些业务挑战。

通常我们希望子域一对一地对应到限界上下文，但这会将领域模型分离到不同的业务板块中，并将问题空间和解空间融合在一起。

### 问题空间（Problem Space）
问题空间是核心域和其他子域的组合，通过对问题空间的分析我们将产生一个新的核心域，同时考虑现有的子域及额外所需的子域。
通过以下措施保障执行的准确性：
1. 战略核心域名称是什么，目标是什么？
2. 战略核心域中包含哪些概念？
3. 核心域的支撑子域和通用子域是什么？
4. 如何安排项目人员？
5. 能否组织一只合适的团队？

### 解空间（Solution Space）
解空间包含一个或多个限界上下文，即一组特定的软件模型。限界上下文即是一个特定的解决方案，通过软件的形式实现解决方案。
通过以下措施来执行：
1. 哪些软件资产已存在并可以重用？
2. 哪些资产需要创建或从别处获取？
3. 这些资产如何集成到一起？
4. 结合现有情况，还需要做什么？
5. 核心域和支撑域成功率如何？以及评估失败后产生的影响。
6. 哪些地方我们使用了完全不同的术语。
7. 限界上下文之间是否存在概念重叠？
8. 重叠的概念如何在限界上下文中进行映射和翻译？

## 限界上下文
限界上下文是一个显示的边界，领域模型存在于边界内。领域模型将限界上下文中的通用语言表达成软件模型。
在一个领域/子域中，我们会创建一个概念上的领域边界，在这个边界中，任何领域对象都只表示特定于该边界内部的确切含义。这样边界便称为限界上下文，限界上下文和领域具有一对一的关系。

## 通用语言
将一个限界上下文中的所有概念，包括名词、动词和形容词全部集中在一起，我们便为该限界上下文创建了一套通用语言。

# 上下文映射图
上下文映射图（Context Map）用于标识两个或多个限界上下文之间的映射关系。限界上下文之间的集成关系也可以理解为是领域概念在不同上下文之间的映射关系，限界上下文之间的集成也称为上下文映射图。
>U表示上游（Upstream），D表示下由（Downstream）。

## 组织关系
- 合作关系（Partnership）：共存亡的协作关系，双方一切协调开发计划和集成管理。
- 共享内核（Shared Kernel）：双方引用了共同的模型和代码，这种情况下一方如果更改了模型或代码对另一方会造成影响。
- 客户端-供应方开发（Customer-Supplier Development）：上下游关系，上游团队可独立与下游开发，但下游团队的开发进展受上游团队研发进度影响。
- 遵奉着（Conformist）：上下游关系，上游团队已经没有动力提供下游团队的所需，导致下游团队处于孤立无援的状态。上游团队给予各种承诺但往往完成不了，而下游团队只能盲目上游团队提供的模型。
- 防腐层（Anticorruption Layer）：下游不再依托于上游的研发进度，按照自己的领域模型创建业务层，上游做为系统代理提供功能实现。
- 开放主机服务（Open Host Service）：公开一种协议让其他人可以访问。
- 发布语言（Published Language）：约定一种数据发布的标准，配套开发主机服务一起使用。
- 另谋他路（SeparateWay）：当两套功能没有关系时不要存在耦合关系。
- 大泥球（Big Ball of Mud）：系统混杂的各种领域模型，没有明确的领域边界。

### 上下文映射图的表示
- ACL表示防腐层：可以用领域服务（Domain Service）来定义防腐层，也可以作用于资源库（Repository）接口。
- OHS表示开放主机服务：可以通过REST实现，也可以使用远程过程调用（RemoteProcedureCall，RPC），还可以通过消息机制实现。
- PL表示发布语言：可以使用XML、Json，或者自定义类（DTO），同时还可以通过领域事件（Domain Event）以消息的形式发送到订阅方。


# 架构
DDD不需要使用特定的架构，核心域位于限界上下文中，我们可以在整个系统中使用多种风格的架构。

## 分层架构
DDD可采用分层架构，用于应用层下面，基础设施层上面的领域层。
用户界面层（User Interface） -> 应用层（Application Layer）=> 领域层（Domain Layer） -> 基础设施层（Infrastructure Layer）。




## 术语一览
- 通用语言：它是用于捕获特定业务领域中的概念和术语，团队对业务进行沟通交流的语言，包括名词、形容词、动词和一些富有含义的语句。
- 限界上下文：概念性的边界，边界内的每种领域术语、词组或语句都有确定的上下文含义，边界外则可能表示不同的意思。
- 上下文映射图：
- 领域（Domain）：
- 子域（Subdomain）：
- 核心域(Core Domain)：
- 支撑域：
- 通用域：
- 领域模型：
- 问题空间：
- 解空间：
- 问题域：指的是领域承担的职责和面临的挑战
- 战略设计：
- 战术设计：
- 实体
- 值对象
- 聚合
- 领域服务
- 领域事件

## 战略设计
DDD的战略设计主要包括领域/子域、通用语言、限界上下文和架构风格等概念。




### 提取通用语言

#### 梳理业务用例
梳理系统中的实现内容

1. 标段从业务系统同步到评标系统中
2. 标段到了开标时间后可公布投标人
3. 投标人可进行签到
4. 招标人可对投标人做退回操作
5. 对投标文件做信封拆封
6. 对拆封后的投标文件进行读取
7. 对投标文件中的唱标信息进行内容展示
8.

#### 提取通用语言
对内容梳理名称、动词和副词形成通用语言

#### 引入问题空间

###


### 关联关系
- 合作关系
- 共享内核
- 客户方-供应方开发
- 遵奉者

防腐层（ACL）
开发主机服务（OHS）
发布语言（PL）
另谋他路



### 开标核心域
1、需要招投标平台提供开标所需的数据
2、需要评标办法提供开标流程管理
陆俊峰团队+荣毅团队

### 评标核心域
1、需要开标系统提供评标所需的数据
2、需要业务系统提供参与评标的评委名单
3、需要评标办法提供评标流程管理
冯献鹏团队+肖宇团队








>
https://www.jianshu.com/p/cdbefdd55b99
