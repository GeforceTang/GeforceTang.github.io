---
title: 操作系统
date: 2022-05-02 14:08:43
categories: 软考笔记
tags: 系统分析
---

## 知识点提要

> 进程管理
>
> - 进程的状态(⭐)
> - 绝对路径与相对路径(⭐)
> - 前趋图(⭐⭐⭐⭐)
> - 索引文件(⭐)
>
> 存储管理
>
> - 段页式存储(⭐⭐⭐)
> - 页面置换算法(⭐)
>
> 文件管理
>
> - 信号量与PV操作(⭐⭐⭐⭐⭐)
> - 位示图(⭐⭐⭐)
> - 死锁及银行家算法(⭐⭐⭐)
>
> 设备管理
>
> - 数据传输控制方式(⭐⭐⭐)
>
> 微内核操作系统(⭐)
>
> 嵌入式操作系统(⭐)


## 操作系统概述

操作系统（OS，Operating System）：在计算机硬件之上，运行软件的软件系统。

- 管理系统的硬件、软件、数据资源
- 控制程序运行
- 人机之间的接口
- 应用软件与硬件之间的接口

主要任务如下：

- 进程管理
- 存储管理
- 文件管理
- 作业管理
- 设备管理

## 进程管理

### 进程和线程

进程是程序在一个数据集合上运行的过程，它是系统进行资源分配和调度的一个独立单位。它由程序块、进程控制块(PCB) 和数据块三部分组成。

- PCB: PCB是进程存在的唯-标志。内容包含进程标识符、状态、位置信息、控制信息、队列指针(链接同一状态的进程)、优先级、现场保护区等。

#### 进程与程序的区别

进程是程序的一次执行过程，没有程序就没有进程。

程序是一个静态的概念，而进程是一个动态的概念，它由创建而产生，完成任务后因撤销而消亡;进程是系统进行资源分配和调度的独立单位，而程序不是。

进程的2个基本属性: 可拥有资源的独立单位;可独立调度和分配资源的基本单位。

![操作系统-进程](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/操作系统-进程.png)

#### 例题

在支持多线程的操作系统中，假设进程P创建了若干个线程，那么( C )是还能被这些线程共享的。
A 该进程中打开的文件
B 该进程的代码段
C 该进程中某线程的栈指针
D 该进程的全局变量

### 进程的状态

![操作系统-进程状](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E8%BF%9B%E7%A8%8B%E7%8A%B6.png)

3态模型：

- CPU会以时间片来运行进程，所有会有就绪态和运行态。
- 当某个资源不满足时，会变成阻塞态。
- 资源满足后，会重新变成就绪态。

5态模型：相比3态模型多了一种挂起的行为。挂起是当内存资源不足时，将某些进程挂起放到磁盘兑换区中，暂时不参与调度。可以简单理解为将进程从内存放入到磁盘的过程。

- 3态模型中每一种状态都可以挂起
- 阻塞态挂起后称为静止阻塞态
- 运行态和就绪态挂起后称为静止就绪态
- 静止阻塞态可以变成静止就绪态
- 挂起也可以由代码来控制

### PV操作

> PV操作属于进程管理中的重点、难点知识库

#### 同步与互斥

互斥：进程与进程之间相互抵制，只允许一个进程使用。间接制约关系。

同步：允许多个进程同步运行，到了某个点同步等待。直接制约关系。

- 临界资源：诸进程间需要互斥方式对其进行共享的资源，如缓冲区、打印机、磁带机等。
- 临界区：每个进程中访问临界资源的那段代码称为临界区。
- 信号量：是一种特殊的变量，是全局变量。用于记录特定的资源数量。

注: P是荷兰语的Passeren, V是荷兰语的Verhoog。操作系统中的原语，要么做要么不做。

#### P操作

S=S-1，if(S<0)？将当前进程放入阻塞队列中，等待执行：执行后续操作

信号量可以理解为资源数量，而P操作相当于申请并占用资源（所以需要对资源-1），加锁，检测资源。

#### V操作

S=S+1，if(S<=0)？从阻塞队列中唤醒一个进程：不通知，始终执行后续操作。

V操作是一个释放资源的过程，并且当S<0时（S为负表示的是排队的进程数量）需要通知阻塞队列进程进入就绪态（所以V操作是先执行当前进程的后续逻辑，再执行阻塞队列中的通知进程）。

`PV是成对存在的，只加锁不解锁会出现死锁，只解锁不加锁没有任何意义。`

#### 互斥模型

多条进程共享一台打印机（互斥模型）：P(S) -> 使用打印机 -> V(S) -> 后续代码

互斥信号量取值范围：比方有5台打印机，最多8个进程来访问，则信号量最大为5，最小为-3。

##### 缓冲区

生产者 =》 生产一件产品 -> P(S<sub>缓冲区</sub>) -> 产品存放到缓冲区 -> V(S<sub>产品</sub>)

消费者 =》 P(S<sub>产品</sub>) -> 从缓冲区取产品 -> V(S<sub>缓冲区</sub>) -> 消耗一件产品

S<sub>缓冲区</sub>初始值为1，S<sub>产品</sub>为0。

##### 加锁

对缓冲区操作定义访问权，同一时间只允许一个人访问。通过定义型号量S<sub>锁</sub>来作为一把锁，初始值为1，P操作加锁，V操作解锁，对缓冲区操作的前后通过PV来实现加锁处理。

#### 例题

假设某系统采用非抢占式优先级调度算法，若该系统有两个优先级相同的进程P1和P2，各进程的程序段如下所示，若信号量S1和S2的初值都为0。进程P1和P2并发执行后a、b和c的结果分别为: a= ( 1 )，b=( 2 )，C=( 3 )。

| P1程序段:                                                    | P2程序段：                                                   |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| begin{<br/>    a:=1;<br/>    a:=a+1;<br/>    V(S1); <br/>    c:=a+5;<br/>    P(S2);<br/>    a:=a+c;<br/>    }<br/>end | begin{<br/>    b:=2;<br/>    b:=b+1;<br/>    P(S1);<br/>    b:=a+b; <br/>    V(S2);<br/>    c:=b+c;<br/>    }<br/>end |

(1) A.9	B.12	C.13	D.14
(2) A.5	B.6	C.9	D.10
(3) A.4	B.6	C.12	D.13

解题：

1. 并行执行，P1执行到P(S2);时阻塞，P2执行到P(S1);时阻塞。
2. 此时a=2,c=7,b=3.
3. P1执行V操作会释放P2的阻塞，P2进程继续运行到结尾
4. 此时b=5,c=12
5. 接下来P2执行V操作释放P1的阻塞，P1进程继续运行
6. a=12+2=14
7. a=14,b=5,c=12  DAC

### 前趋图

前趋图(Precedence Graph)是一个有向无环图，代表一个进程内部的任务执行关系。记为:->={(Pi, Pj )|Pi must complete before Pj may strat}。假设系统中进程P={P1, P2，P3, P4,
P5，P6, P7, P8}，且进程的前驱图如下:那么前驱图可记为:()。
A ->={(P2,P1),(P3,P1),(P4,P1),(P6,P4),(P7,P5),(P7,P6),(P8,P7)}
B ->={(P1,P2),(P1,P3),(P1,P4),(P2,P5),(P5,P7),(P6,P7),(P7,P8)}
C ->={(P1,P2),(P1,P3),(P1,P4),(P2,P5),(P3,P5),(P4,P6),(P5,P7),(P6,P7),(P7,P8)}
D ->={(P2,P1),(P3,P1),(P4,P1),(P5,P2),(P5,P3),(P6,P4),(P7,P5), (P7,P6),(P8,P7)}

#### 例题

某计算机系统中有一个CPU、一台扫描仪和一台打印机。现有三个图像任务，每个任务有三个程序段:扫描Si，图像处理Ci和打印Pi(i=1, 2，3)。下图为三个任务各程序段并发执行的前驱图，其中，( )可并行执行，( )的直接制约，( )的间接制约。

![进程管理-前趋图](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86-%E5%89%8D%E8%B6%8B%E5%9B%BE.png)

A “C1S2”，“P1C2S3”，“P2C3”
B “ClS1”，“S2C2P2”，“C3P3”
C “S1C1P1”，“S2C2P2”，“S3C3P3”
D “S1S2S3”，“C1C2C3”，“P1P2P3”

A S1受到S2和S3、C1受到C2和C3、P1受到P2和P3
B S2和S3受到S1、C2和C3受到C1、P2和P3受到P1
C C1和P1受到S1、C2和P2受到S2、C3和 P3受到S3
D Cl和S1受到P1、C2和S2受到P2、C3和S3受到P3

A S1受到S2和S3、C1受到C2和C3、P1受到P2和P3
B S2和S3受到S1、C2和C3受到C1、P2和P3受到P1
C C1和P1受到S1、C2和P2受到S2、C3和P3受到S3
D C1和S1受到P1、C2和S2受到P2、C3和S3受到P3

解题：

1. 并行任务：当前一个任务完成后，后续任务不受前趋图和资源的限制可以直接执行的任务。
2. 直接制约：由同一个进程，任务的前趋图前后关系来做的直接限制。
3. 间接制约：由不同的进程，同一个任务被资源来做的间接限制。

### 死锁

进程 管理是操作系统的核心，但如果设计不当，就会出现死锁的问题。如果一个进程在等待一件不可能发生的事，则进程就死锁了。而如果一个或多个进程产生死锁，就会造成系统死锁。

#### 死锁四大条件

- 进程之间对资源的占用、互斥不共享
- 进程保持当前资源不释放，并持续等待
- 进程缺少资源不会去剥夺已经被占用的资源
- 进程之间的互相等待资源对方的资源释放

预防死锁就是打破上述的四大条件，方式有：对资源的有序分配和使用银行家算法。

#### 资源有序分配

系统有3个进程: A、B、C。这3个进程都需要5个系统资源。如果系统至少有多少个资源，则不可能发生死锁。

1. n<5，肯定死锁。
2. 当n=[5,12]，处于可以正常执行也可能发生死锁的情况。
3. n=3*(5-1)+1=13，可以避免发散死锁的最小资源数。

#### 银行家算法

银行家算法: 分配资源的基本原则

1. 当一个进程对资源的最大需求量不超过系统中的资源数时可以接纳该进程
2. 进程可以分期请求资源，但请求的总数不能超过最大需求量
3. 当系统现有的资源不能满足进程尚需资源数时，对进程的请求可以推迟分配，但总能使进程在有限的时间里得到资源

##### 例题1

假设系统中有三类互斥资源R1、R2、R3,可用资源分别是9、8、5。在T0时刻系统中有P1、P2、 P3、P4和P5五个进程，这些进程对资源的最大需求量和已分配资源数如下所示，如果进程按（）序列执（）行，那么系统状态是安全的。

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503162001197.png" alt="20220503162001197" style="zoom:80%;" />

供选择的答案:
A. P1 -> P2 -> P4 -> P5 -> P3
B. P2 -> P4 -> P5 -> P1 -> P3
C. P2 -> P1 -> P4 -> P5 -> P3
D. P4 -> P2 -> P5 -> P1 -> P3

解题：

1. 解出当前资源剩余量，R1：2，R2：1，R3：1
2. 计算出各个进程还需要的资源量

​	P1：5、3、1

​	P2：0、1、0

​	P3：6、0、1

​	P4：0、0、1

​	P5：2、3、1

3. 由上可得，P2和P4均是安全的，但是P2分配后带来的收益要高。
4. P2完成后资源如下：4、3、2，P4和P5均是安全的。
5. 由此可得选B。

##### 例题2

假设某银行拥有的资金数是10，现在有4个用户a、b、c、d,各自需要的最大资金数分别是4、5、6、7。若在图a的情况下，用户a和b又各申请1个资金，则银行分配后用户a、b、c、d尚需的资金数分别为( 1 ) ; 假设用户a已经还清所有借款，其情况如图b所示，那么银行的可用资金数为( 2 ) 。若在图b的情况下，银行为用户b、c、d各分配资金数1、1、2，则银行分配后用户b、c、d已用资金数分别为( 3 )。

![image-20220503163115119](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503163115119.png)

A. 2、2、3、3，可用资金数为0，故系统状态是不安全的
B. 3、3、3、5，可用资金数为0，故系统状态是不安全的
C. 2、2、4、6，可用资金数为2，故系统状态是安全的
D. 3、3、3、5，可用资金数为2,故系统状态是安全的

A. 4	B. 5	C. 6	D.7

A. 4、3、2，尚需资金数分别为1、3、5，故系统状态是安全的
B. 4、3、3，尚需资金数分别为1、3、4，故系统状态是安全的
C. 4、3、2，尚需资金数分别为1、3、5，故系统状态是不安全的
D. 4、3、3，尚需资金数分别为1、3、4，故系统状态是不安全的

解题：

（ 1 ） C

（ 2 ） A

（ 3 ） D

## 存储管理

操作系统会将外存的文件调入到内存当中供CPU来调用，如果文件不存在于内存中则会产生缺页中断，以从外存调用数据。

如果文件很大是无法完全放入到内存中，所以一般会将文件内容进行切割后再放置到内存中。

### 页式存储

> 掌握逻辑地址与业务地址的转换关系及计算。

页式存储：将程序与内存均划分为同样大小的块，以页为单位将程序调入内存。

- 优点：利用率高，碎片小，分配及管理简单
- 缺点：增加了系统开销;可能产生抖动现象

![image-20220503164037631](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503164037631.png)

高级程序语言使用逻辑地址；运行状态，内存中使用物理地址。

- 逻辑地址 = 页号 + 页内地址
- 物理地址 = 页帧号 + 页内地址

例如，页式存储系统中，每个页的大小为4KB。
逻辑地址：10 1100 1101 1110
对应的物理地址为：110 1100 1101 1110

#### 页内大小

比如4k=2<sup>12</sup> = 12个bit位，表示每一页需要12位，也就是说地址长度就是12位。

#### 内存管理

当需要的资源不在内存中，会除法缺页中断，通过用户程序的页号从页表中查找对应的块号，找到物理地址，将数据加载到内存中。

如果这个过程内存空间不足时，则会采取一定的措施来释放内存资源，淘汰的原则如下：

![image-20220503170259573](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503170259573.png)

- 状态位不为1的是不在内存中，所以不会被淘汰。
- 优先淘汰访问位为0的页（为1可能近期会被用到）。访问位会定时清零，存在时间限制。
- 其次淘汰修改位为1的页（为1淘汰成本比较大）。

#### 例题

进程P有8个页面，页号分别为0~7，页面大小为4K，假设系统给进程P分配了4个存储块，进程P的页面变换表如下所示。表中状态位等于1和0分别表示页面在内存和不在内存。若进程P要访问的逻辑地址为十六进制5148H，则该地址经过变换后，其物理地址应为十六进制( A ) 。
A 3148H	B 5148H	C 7148H	D 9148H

解题：

1. 5148H，按照4K分配，5为页号，148为页面地址
2. 5对应的物理地址为3，则业务地址3148H。

### 段式存储

考虑到实际的程序运行情况，结合逻辑的连贯性场景，按用户作业中的自然段来划分逻辑空间，然后调入内存，段的长度可以不一样。

- 优点：多道程序共享内存，各段程序修改互不影响
- 缺点：内存利用率低，内存碎片浪费大

![image-20220503203231548](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503203231548.png)

逻辑段地址：（段号，段内偏移量），当段内偏移量超出了段长则段地址非法。

段表式存储了程序段所能访问的合法物理地址，比如段号（0）、段长为10K、基地为20K，则逻辑段地址只能设置(0,0~10K)

#### 例题

假设系统采用段式存储管理方法，进程P的段表如下所示。逻辑地址( D )不能转换为对应的物理地址;不能转换为对应的物理地址的原因是进行( C )。

| 段号 | 基地址 | 段长 |
| ---- | ------ | ---- |
| 0    | 1100   | 800  |
| 1    | 3310   | 50   |
| 2    | 5000   | 200  |
| 3    | 4100   | 580  |
| 4    | 2000   | 100  |

A (0,790)和(2,88)
B (1,30)和(3,290)
C (2,88)和(4,98)
D (0,810)和(4,120)

A 除法运算时除数为零
B 算术运算时有溢出
C 逻辑地址到物理地址转换时地址越界
D 物理地址到逻辑地址转换时地址越界

### 段页式存储

段页式存储:段式与页式的综合体。先分段，再分页。1个程序有若干个段，每个段中可以有若干页，每个页的大小相同，但每个段的大小不同。

- 优点：空间浪费小、存储共享容易、存储保护容易、能动态连接
- 缺点：由于管理软件的增加，复杂性和开销也随之增加，需要的硬件以及占用的内容也有所增加，使得执行速度大大下降

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503211533819.png" alt="image-20220503211533819" style="zoom:75%;" />

逻辑地址：（段号，页号，页内地址）

### 快表

快表是一块小容量的相联存储器(Associative Memory) ，由高速缓存器组成，速度快，并且可以从硬件上保证按内容并行查找，一般用来存放当前访问最频繁的少数活动页面的页号。

快表：将页表存于Cache上；慢表：将页表存于内存上。

### 页面置换算法

- 最优(Optimal,OPT)算法：理想型，验证其他算法的有效性。
- 随机(RAND)算法
- 先进先出(FIFO) 算法:有可能产生“抖动”。例如，432143543215序列，用3个页面，比4个缺页要少
- 最近最久未使用(LRU) 算法:不会“抖动”，LRU的理论依据是“局部性原理”。
- LFU (Least Frequently Used) 算法根据数据的历史访问频率来淘汰数据，其核心思想是“如果数据过去被访问多次，那么将来被访问的频率也更高”。LFU的
  每个数据块都有一个引用计数，所有数据块按照引用计数排序，具有相同引用计数的数据块则按照时间排序。

时间局部性：刚被访问的内容，立即又被访问。

空间局部性：刚被访问的内容，临近的空间很快被访问。

## 文件管理

### 索引文件结构

文件在逻辑上一定是连续的，在物理上可以是分散的。

索引是一个地址指向，可以理解为物理块号。比如0号索引存储的是99，表示指向了99块号的存储空间。

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503213316109.png" alt="image-20220503213316109" style="zoom:67%;" />

- 直接索引方式：索引存储内容是直接指向了物理块号，这些物理块存储的是文件数据。
- 一级间接索引：索引存储内容指向的是另一个索引表，这个索引块采用了直接索引方式。
- 二级间接索引：同上。
- 三级间接索引：同上。

#### 例题1

假设文件系统采用索引节点管理，且索引节点有8个地址项iaddr[0]\~iaddr[7],每个地址项大小为4字节，iaddr[0]\~iaddr[4]采用直接地址索引，iaddr[5]和iaddr[6]采用一级间接地址索引，iaddr[7]采用二级间接地址索引。假设磁盘索引块和磁盘数据块大小均为1KB字节，文件File1的索引节点如下图所示。若用户访问文件File1中逻辑块号为5和261的信息，则对应的物理块号分别为( ); 101号物理块存放的是( )。

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503221838311.png" alt="image-20220503214812331" style="zoom: 67%;" />

A.89和90	B.89和136	C.58和187	D.90和136
A.File1的信息	B.直接地址索引表	C.一级地址索引表	D.二级地址索引表

解题：

注意物理块号是连续的，从0开始。

1. iaddr[0\~4]为直接索引，iaddr[5\~6]是一级索引，iaddr[7]是二级索引。
2. 磁盘索引块/数据块大小为1KB，地址项大小为4B，则每个索引块可以存放1KB/4B=256个索引映射。
3. 逻辑块号5对应的是物理块58
4. iaddr[6]中的第一个逻辑块号 = 4+256+1 = 261，对应物理块号187
5. 101在逻辑块号iaddr[7]上，为二级地址索引。

#### 列题2

某文件系统文件存储采用文件索引节点法。假设磁盘索引块和磁盘数据块大小均为1KB，每个文件的索引节点中有8个地址项iaddr[0]~iaddr[7]，每个地址项大小为4字
节，其中iaddr[0]~iaddr[5]为直接地址索引，iaddr[6]是一级间接地址索引，iaddr[7]是二级间接地址索引。如果要访问icwutil.dIl文件的逻辑块号分别为0、260和518，则系统应分别采用( A )。该文件系统可表示的单个文件最大长度是( D ) KB。

A 直接地址索引、一级间接地址索引和二级间接地址索引
B 直接地址索引、二级间接地址索引和二级间接地址索引
C 一级间接地址索引、一 级间接地址索引和二级间接地址索引
D 一级间接地址索引、 二级间接地址索引|和二级间接地址索引

A 518	B 1030	C 16514 	D 65798

解题：

1. 1KB / 4B = 256，每个索引项可以映射256个地址。
2. 0\~5采用直接索引，6\~261采用一级索引，262~65797采用二级索引。
3. 6\*1KB + 256\*1KB + 256\*256\*1KB = 6KB + 256KB + 65536KB = 65798KB。

### 位示图

用于表现系统中存储空间空着的方法，有以下几种：

- 空闲区表法(空闲文件目录)
- 空闲链表法
- 位示图法
- 成组链接法

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503221147629.png" alt="image-20220503221147629" style="zoom:60%;" />

以16bit来表示一个位，0号磁盘放到[0,0]的位置上，15号磁盘放到[0,15]上，16号磁盘放到[1,0]上。

位示图字号置为1表示占用，置为0表示释放。

#### 例题1

某字长为32位的计算机的文件管理系统采用位示图(bitmap) 记录磁盘的使用情况。若磁盘的容量为300GB，物理块的大小为1MB，那么位示图的大小为( )个字。
<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503221838311.png" alt="image-20220503221838311" style="zoom:60%;" />
A、1200	B、3200	C、6400	D、9600

解题：

1. 字长为32位，300GB/1MB=300\*2<sup>10</sup>MB/1MB=300\*2<sup>10</sup>个磁盘块。
2. 300\*2<sup>10</sup>/2<sup>5</sup> = 300\*32 = 9600

扩展：

比如逻辑盘号[0,2048]对应的位示图编号为？

2048/32 = 64，所以要放到第65个字的位置上，注意编号是从0开始的，所以位示图字号为[64,0]

#### 例题2

某文件管理系统在磁盘上建立了位示图(bitmap),记录磁盘的使用情况。若磁盘上物理块的编号依次为: 0、1、2、...；系统中的字长为32位，字的编号依次为:
0、1、2、...，字中的一位对应文件存储器上的一个物理块，取值0和1分别表示空闲和占用，如下图所示。
<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503221838311.png" alt="image-20220503221838311" style="zoom:60%;" />

假设操作系统将2053号物理块分配给某文件，那么该物理块的使用情况在位示图中编号为( C )的字中描述；系统应该将( B )。
A 32	B 33	C 64	D 65

A 该字的位号5的位置“0”
B 该字的位号5的位置“1”
C 该字的位号6的位置“0”
D 该字的位号6的位置“1”

解题：

1. 2053号是第2054个物理块。
2. 2054 / 32 = 64 余 6。所以为第65个字的第6个位号。
3. 因为是从0开始，所以位示图字号[64,5]

### 树形目录结构

文件名的组成：驱动器号、路径、主文件名、扩展名。

- 绝对路径：是从盘符开始的路径。
- 相对路径：是从当前目录开始的路径。
- 若当前目录为：D1，要求F2路径，则：绝对路径:/D1/W2/F2，相对路径:W2/F2

文件属性：

- R只读文件属性
- A存档属性
- S系统文件
- H隐藏文件

## 输入输出技术

输入/输出 = I/O，CPU -> 内存 -> 外存

### 数据传输控制方式

- 程序控制(查询)方式：分为无条件传送和程序查询方式两种。方法简单，硬件开销小，但I/O能力不高，严重影响CPU的利用率。
- 程序中断方式：与程序控制方式相比，中断方式因为CPU无需待而提高了传输请求的响应速度。（CPU运行与数据传输是并行的，提升了CPU的利用率）
- DMA方式: DMA方式是为了在主存与外设之间实现高速、批量数据交换而设置的。DMA方式比程序控制方式与中断方式都高效。（CPU不参与数据交换的过程）

(DMAC向总线裁决逻辑提出总线请求; CPU执行完当前总线周期即可释放总线控制权。此时DMA响应，通过DMAC通知I/O接口开始DMA传输。)

- 通道方式（硬件方式）
- I/O处理机（硬件方式）

#### 中断处理过程

1. CPU无需等待也不必查询I/O状态。
2. 当I/0系统准备好以后，发出**中断请求信号**通知CPU;
3. CPU接到中断请求后，保存正在执行程序的现场(**保存现场**)，打断的程序当前位置即为**断点**;
4. (通过**中断向量表**) 转入/0中的服务程序的执行，完成I/O系统的数据交换;
5. 返回被打断的程序继续执行(恢复现场)。

### IO管理软件

了解知识点：分层和作用

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503225954317.png" alt="image-20220503225954317" style="zoom:67%;" />

- 硬件：完成具体的I/O操作。
- 中断处理程序：I/O完成后唤醒设备驱动程序
- 设备驱动程序：设置寄存器，检查设备状态
- 设备无关I/O层：设备名解析、阻塞进程、分配缓冲区
- 用户级I/O层：发出I/O调用。

### 例题

#### 例题1

计算机系统中常用的输入/输出控制方式有无条件传送、中断、程序查询和DMA方式等。当采用( D )方式时，不需要CPU执行程序指令来传送数据。
A.中断	B.程序查询	C.无条件传送	D. DMA

#### 例题2

计算机运行过程中，遇到突发事件，要求CPU暂时停止正在运行的程序，转去为突发事件服务，服务完毕，再自动返回原程序继续执行，这个过程称为( B )，其处理过程中保存现场的目的是( C )。
A 阻塞	B 中断	C 动态绑定	D 静态绑定

A 防止丢失数据
B 防止对其他部件造成影响
C 返回去继续执行原程序
D 为中断处理程序提供数据

#### 例题3

CPU是在( D )结束时响应DMA请求的。
A 一条指令执行	B 一段程序	C 一个时钟周期	D 一个总线周期

#### 例题4

I/O设备管理软件-般分 为4个层次，如下图所示。图中①②③分别对应( D )。
A.设备驱动程序、虚设备管理、与设备无关的系统软件
B.设备驱动程序、与设备无关的系统软件、虚设备管理
C.与设备无关的系统软件、中断处理程序、设备驱动程序
D.与设备无关的系统软件、设备驱动程序、中断处理程序

## 微内核操作系统

现代操作系统大多拥有两种工作状态，分别是核心态和用户态。一般应用程序工作在用户态，而内核模块和最基本的操作系统核心工作在核心态。
将传统的操作系统代码放置到更高层，从操作系统中去掉尽可能多的东西，而只留下最小的核心，称之为微内核。(C/S结构)

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503230719925.png" alt="image-20220503230719925" style="zoom:80%;" />

**操作系统的内核服务：异常和中断、计时器、I/0管理等**。

|          | 实质                                                         | 优点                                                         | 缺点                                                         |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 单体内核 | 将图形、设备驱动及文件系统等功能全部在内核中实现，运行在内核状态和同一地址空间。 | 减少进程间通信和状态切换的系统开销，获得**较高的运行效率**。 | 内核庞大，占用资源较多且不易剪裁。<br/>系统的**稳定性和安全性不好**。 |
| 微内核   | 只实现基本功能，将图形系统、文件系统、设备驱动及通信功能放在内核之外。 | 内核精练，便于剪裁和移植。<br/>系统服务程序运行在用户地址空间，**系统的可靠性、稳定性和安全性较高**。<br/>**可用于分布式系统** | 用户状态和内核状态需要频繁切换，从而导致系统效率不如单体内核。 |

### 例题

采用微内核结构的操作系统提高了系统的灵活性和可扩展性，( A )。
A 并增强了系统的可靠性和可移植性，可运行于分布式系统中
B 并增强了系统的可靠性和可移植性，但不适用于分布式系统
C 但降低了系统的可靠性和可移植性，可运行于分布式系统中
D 但降低了系统的可靠性和可移植性，不适用于分布式系统

## 嵌入式操作系统

嵌入式系统（EOS）主要由嵌入式硬件平台、相关支撑硬件、嵌入式操作系统、支撑软件和应用软件组成。其中，嵌入性、专用性和计算机系统是嵌入式系统的三个核心要素。
典型的嵌入式系统具有以下特点:

- 系统专用性强
- 系统实时性强
- 软硬件依赖性强
- 处理器专用
- 多种技术紧密结合
- 系统透明性
- 系统资源受限

### 嵌入式操作系统特点

(1) 微型化

(2) 代码质量高

(3) 专业化

(4) 实时性强

(5) 可裁减、可配置。

针对不同的硬件平台，操作系统通常建立在一个硬件抽象层(HAL)上（板级支撑包BSP），该层位于底层硬件和内核之间，为内核提供各种方便移植的宏定义接口，在不同的平台间移植时，只需要修改宏定义即可。

与硬件相关，与操作系统相关。

### 嵌入式开发与设计

在宿主机上开发，开发完成之后烧制在目标机上（集成电路），开发过程的交互可以通过USB、仿真器、以太网等完成连接。这个就是交叉开发环境。

宿主机系统：交叉编译器、交叉链接器、调试器

目标机系统：动态装载器、链接装载器、调试监视器、调试代理

<img src="https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220503232944162.png" alt="image-20220503232944162" style="zoom:50%;" />

#### 基于硬件的低功耗设计

板级电路低功耗设计；选择低功耗处理器；总线的低功耗设计；接口驱动电路的设计；分区分时供电技术。

#### 基于软件的低功耗设计

编译优化技术(指令 开销)；软件与硬件的协同设计(硬件功能交由软件完成)；算法优化(低时间复杂度)。

### 例题

#### 例题1

以下关于嵌入式系统开发的叙述正确的是( C )。
A 宿主机与目标机之间只需要建立逻辑连接
B 宿主机与目标机之间只能采用串口通信方式
C 在宿主机上必须采用交叉编译器来生成目标机的可执行代码
D 调试器与被调试程序必须安装在同一台机器上

#### 例题2

以下关于嵌入式系统硬件抽象层的叙述，错误的是( D )。
A 硬件抽象层与硬件密切相关，可对操作系统隐藏硬件的多样性
B 硬件抽象层将操作系统与硬件平台隔开
C 硬件抽象层使软硬件的设计与调试可以并行
D 硬件抽象层应包括设备驱动程序和任务调度

#### 例题3

以下描述中，( B )不是嵌入式操作系统的特点。
A 面向应用，可以进行裁剪和移植二
B 用于特定领域，不需要支持多任务
C 可靠性高，无需人工干预独立运行，并处理各类事件和故障
D 要求编码体积小，能够在嵌入式系统的有效存储空间内运行

## 实时操作系统

常见的嵌入式RTOS (实时操作系统, Real-Time OperatingSystem)VxWorks、RT-Linux、 QNX、 pSOS。

| 比较类型   | VxWorks                            | RT-Linux                           |
| ---------- | ---------------------------------- | ---------------------------------- |
| 工作方式   | 操作系统与应用程序处于同一存储空间 | 操作系统与应用程序处于不同存储空间 |
| 多任务支持 | 支持多任务(线程)操作               | 支持多进程、多线程操作             |
| 实时性     | 实时系统                           | 实时系统                           |
| 安全性     | 任务间无隔离保护                   | 支持进程间隔离保护                 |
| 标准API    | 支持                               | 支持                               |

### 实时性能指标

- 任务切换时间
- 中断处理相关的时间指标
  - 中断延迟时间
  - 中断响应时间
- 系统响应时间(对用户 的输入或请求作出反应的时间)
- 信号量混洗时间(指从一个任务释放信号量到另一个等待该信号量的任务被激活的时间延迟)

### 多任务调度算法

实时系统存在多种调度算法，在RTOS中，大多数的RTOS调度算法都是抢占式的。

- 优先级调度算法：分配一个相对固定的优先顺序，然后调度程序根据优先级的高低排序，按时间顺序进行高优先级任务优先调度。(非抢 占式)
- 抢占式优先级调度算法：是在优先级调度算法基础上，允许高优先级任务抢占低优先级任务而运行。
- 时间轮转调度算法：调度程序会依次调度每个任务运行-一个小的时间片，然后再调度另一个任务。每个任务运行完一个时间片，无论是否结束都会释放CPU让下一个任务运行。(纯粹的时间轮转调度无法满足实时系统的要求，取而代之的是基于优先级的抢占式时间轮转调度)
- 最晚截止期调度算法：指调度程序按每个任务的最接近其截止期末端的时间进行调度。
- 最早截止期调度算法：指调度程序按每个任务的截止期时间，选择最早到截止期头端时间的任务进行调度。

### 例题

#### 例题1

以下关于RTOS (实时 操作系统)的叙述中，不正确的是( A )。
A RTOS不能针对硬件变化进行结构与功能上的配置及裁剪
B RTOS可以根据应用环境的要求对内核进行裁剪和重配
C RTOS的首要任务是调度- -切可利用的资源来完成实时控制任务
D RTOS实质上就是一个计算机资源管理程序，需要及时响应实时事件和中断

#### 例题2

以下关于实时操作系统(RTOS) 任务调度器的叙述中，正确的是( B )。
A 任务之间的公平性是最重要的调度目标
B 大多数RTOS调度算法都是抢占方式(可剥夺方式) 
C RTOS调度器都采用了基于时间片轮转的调度算法
D 大多数RTOS调度算法只采用- -种静态优先级调度算法
