---
title: 3-数据库系统
date: 2022-05-04 17:42:48
categories: 软考笔记
tags: 系统分析
---



## 知识点提要

> 数据库模式(⭐⭐⭐)
>
> 分布式数据库(⭐)
>
> 数据库设计阶段(⭐)
>
> 概念结构设计-ER模型(⭐)
>
> 逻辑结构设计-关系模式(⭐⭐)
>
> 关系代数(⭐⭐⭐)
>
> 规范化理论(⭐⭐⭐⭐⭐)
>
> 并发控制(⭐)
>
> 数据库的安全性(⭐)
>
> 数据库备份与恢复技术(⭐)

## 数据库模式

三级模式、二级映射。

![image-20220504183022259](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220504183022259.png)

关系的3种类型

- 基本关系(通常又称为基本表或基表)：实际存在的表，实际存储数据的逻辑表示。
- 查询表：查询结果对应的表。
- 视图表：由基表或其他视图表导出的表，本身不独立存储，数据库只存放它的定义，常称为虚表。

### 数据库视图

它一个虚拟表(逻辑上的表)，其内容由查询定义(仅保存SQL查询语句)。同真实的表一样，视图包含一系列带有名称的列和行数据。但是，视图并没有真正存储这些数据，而是通过查询原始表动态生成所需要的数据。

视图的优点：
1、视图能简化用户操作
2、视图使用户能以多种角度看待同一数据
3、视图对重构数据库提供了一定程度的逻辑独立性
4、视图可以对机密数据提供安全保护

#### 物化视图

它不是传统意义上虚拟视图，是实体化视图，其本身会存储数据。同时当原始表中的数据更新时，物化视图也会更新。

（视图存在性能问题，通过物化视图来提高查询性能，但是涉及到修改更新时反而性能影响更大。所以物化视图适用于多查询少更新的场景）

## 分布式数据库

集中制数据库：传统的Oracle、SqlServer，将数据库存放在一套服务器上。

- **数据独立性**。除了数据的逻辑独立性与物理独立性外，还有数据分布独立性(分布透明性，相比于集中式数据库多的能力)。
- **集中与自治共享结合的控制结构**。各局部的DBMS可以独立地管理局部数据库，具有自治的功能。同时，系统又设有集中控制机制，协调各局部DBMS的工作，执行全局应用。
- **适当增加数据冗余度**。在不同的场地存储同一数据的多个副本，可以提高系统的可靠性和可用性，同时也能提高系统性能。
  （提高系统的**可用性**，即当系统中某个节点发生故障时，因为数据有其他副本在非故障场地上，对其他所有场地来说，数据仍然是可用的，从而保证数据的完备性。）
- **全局的一致性、可串行性和可恢复性**。

![image-20220505135710020](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220505135710020.png)

与集中数据库的差别有：

1. 外模式多了全局概念模式；
2. 概念模式多了局部概念摸索和局部概念模式；
3. 多了分片模式和分布模式，分片模式有水平分片、垂直分片和混合分片，将分片的内容如何放置到物理节点上就是分布模式来负责做的事情。

### 分片透明性

指用户不必关心数据是如何分片的，它们对数据的操作在全局关系上进行，即如何分片对用户是透明的。

- 水平分片：将数据行进行分片，存放在不同的物理节点上。比如将数据按不同区域分开存储
- 垂直分片：将数据列进行分片，存放在不同的物理节点上。比如部分常用数据放在一起，不常用数据放一起
- 混合分片：水平+垂直分片

复制透明：用户不用关心数据库在网络中各个节点的复制情况，被复制的数据的更新都由系统自动完成。

位置透明：是指用户不必知道所操作的数据放在何处，即数据分配到哪个或哪些站点存储对用户是透明的。

局部映像透明性(逻辑透明)：是最低层次的透明性，该透明性提供数据到局部数据库的映像，即用户不必关心局部DBMS支持哪种数据模型、使用哪种数据操纵语言,数据模型和操纵语言的转换是由系统完成的。因此，局部映像透明性对异构型和同构异质的分布式数据库系统是非常重要的。

### 二阶段提交

两阶段提交协议2PC，是为了解决同一个事务在分布式数据库不同节点上的事务的一致性。

#### 2PC事务提交的两个阶段

1. 表决阶段，目的是形成一个共同的决定
2. 执行阶段，目的是实现这个协调者的决定

#### 两条全局提交规则

- 只要有一个参与者撤销事务，协调者就必须做出全局撤销决定

- 只有所有参与者都同意提交事务，协调者才能做出全局提交决定

### 例题

#### 例题1

分布式数据库系统除了包含集中式数据库系统的模式结构之外，还增加了几个模式级别，其中( D )定义分布式数据库中数据的整体逻辑结构，使得数据使用方便，如同没有分布一样。
A 分片模式	B 全局外模式	C 分布模式	D 全局概念模式

解题：

1. 分片模式体现的是数据如何切割。
2. 分布模式体现的是数据如何放置。
3. 全部外模式是用户可看到的外模式结构。

#### 列题2

在分布式数据库中包括分片透明、复制透明、位置透明和逻辑透明等基本概念，其中：( D )是指局部数据模型透明，即用户或应用程序无需知道局部场地使用的是哪种数据模型。
A 分片透明	B 复制透明	C 位置透明	D 逻辑透明

#### 例题3

分布式数据库两阶段提交协议中的两个阶段是指( C )。
A 加锁阶段、解锁阶段	B 获取阶段、运行阶段	C 表决阶段、执行阶段	D 扩展阶段、收缩阶段

## 数据库设计过程

1. 掌握数据库设计的各个阶段
2. 明白各个节点的产物内容

![image-20220505151104016](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220505151104016.png)

1. 需求分析：
   - 数据流图：以图的形式来展示数据的流向
   - 数据字典：对数据流图中的数据做具体的解释
   - 需求说明书：对需求的说明
2. 概念结构设计：形成ER模型
3. 逻辑结构设计：将ER图转换位关系模式/关系表（涉及转换规则、规范化理论），同样也会考虑到DBMS（数据库管理系统）的一些特性，对DBMS完成选型。
4. 对数据库响应的分布形式、存储形式、访问形式等涉及到硬件及OS特性的设计，比如索引。

### 概念结构设计

#### ER图

E-R图由实体（Entity）和联系（Relation），以及实体上的属性3个部分组成。

![image-20220505155159611](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220505155159611.png)

##### 联系的类型

两个实体之间的联系有：一对一（1：1）、一对多（1：N）、多对多（N：N）。

#### 概念设计流程

解决ER图冲突问题，先逐个绘制ER图，再结合数据流图和数据字典进行集成，在集成过程中清除冲突。

![image-20220505161632423](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220505161632423.png)

##### 集成的方法:

- 多个局部E-R图一次集成。
- 逐步集成，用累加的方式-次集成两个局部E-R。

##### 集成产生的冲突及解决办法:

- 属性冲突：包括属性域冲突和属性取值冲突。
- 命名冲突：包括同名异义和异名同义。
- 结构冲突：包括同-对象在不同应用中具有不同的抽象，以及同一实体在不同局部E-R图中所包含的属性个数和属性排列次序不完全相同。

### 关系模型

#### 数据模型

数据模型三要素：数据结构、数据操作、数据的约束条件。

- 层次模型：树形结构，子节点只能有一个父节点。
- 网状模型：图的形式，子节点可以有多个父节点。
- 面向对象模型：以对象为结构组装成的模型。
- 关系模型：关系模型的名称就是表名，属性就是列名，每一行数据称为元组或者纪律。表现形式如下。
  - 关系（属性）： 学生（学号，姓名，年龄，班级编号）
  - 关系（属性，依赖）：学生（U,F） U={学号，姓名，年龄，班级编号} F={学号->姓名，姓名->年龄，学号 -> 班级编号}

#### 相关概念

- 目或度：关系模式中的属性个数。
- 候选码或键：元组的唯一标识，且无冗余的属性集合。
- 主码（主键）：候选键中的任意一个。
- 主属性与非主属性：组成候选码的属性就是主属性，其它的就是非主属性。
- 外码（外键）：对外映射关系的主键。
- 全码（ALL-Key）：关系模式的所有属性组是这个关系的候选码。

#### 完整性约束

- 实体完整性约束：规定基本关系的主属性不能取空值。
- 参照完整性约束：关系与关系间的引用，其他关系的主键或空值（外键）。
- 用户自定义完整性约束：应用环境决定（比如数值大小）。
- 触发器：复杂的完整性约束，可以监听触发执行。

### 逻辑结构设计

将ER图转换为关系模型，应用关系规范化优化关系模式。

![image-20220505181311816](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220505181311816.png)

- E-R图向关系模式的转换
  - 实体向关系模式的转换
  - 联系向关系模式的转换
- 关系模式的规范化
- 确定完整性约束(保证数据的正确性)
- 用户视图的确定(提高数据的安全性和独立性)
  - 根据数据流图确定处理过程使用的视图
  - 根据用户类别确定不同用户使用的视图
- 应用程序设计

#### 关系模式转换

ER转换关系模式基本规则：

1. 一个实体型必须转换为一个关系模式
2. 联系转关系模式

- 一对一：作为实体转换，也可以独立关系
- 一对多：作为实体转换，也可以独立关系
- 多对多：独立关系

| 关联关系         | 转换规则                                                     |
| ---------------- | ------------------------------------------------------------ |
| 一对一联系的转换 | 有两种方式<br>- 独立的关系模式：并入两端主键及联系自身属性。(主键: 任一端主键) <br>- 归并(任意一端)：并入另一端主键及联系自身属性。 (主键：保持不变) |
| 一对多联系的转换 | 有两种方式<br>- 独立的关系模式：并入两端主键及联系自身属性。(主键: 炙端主键) <br>- 归并(多端)： 并入另一端主键及联系自身属性。(主键:保持不变) |
| 多对多联系的转换 | 只有一种方式<br>- 独立的关系模式：并入两端主键及联系自身属性。(主键:两端主键的组合键) |

##### 小结

| 联系类型 | 实体<br>(独立关系模式) | 联系<br>(独立关系模式) | 联系<br>(归并关系模式) | 备注         |
| -------- | :--------------------: | :--------------------: | :--------------------: | ------------ |
| 1对1     |           ✔            |           ✔            |           ✔            | 并入任一端   |
| 1对多    |           ✔            |           ✔            |           ✔            | 并入多端     |
| 多对多   |           ✔            |           ✔            |           ✗            | 只能独立关系 |

### 例题

#### 例题1

在数据库设计的( C )阶段进行关系规范化。
A 需求分析	B 概念设计	C 逻辑设计	D 物理设计

解题：

1. 需求分析是对需求分析形成数据流图和数据字典。
2. 概念设计对需求设计的产物进一步分析形成ER模式
3. 逻辑设计是概念设计的产物ER图进一步细化，并做关系规范化。
4. 物理设计是具体物理存储、物理分布、物理访问。

#### 例题2

在数据库设计的需求分析阶段应完成包括( C )在内的文档。
A E-R图	B 关系模式	C 数据字典和数据流图	D 任务书和设计方案

解题：

1. ER图 -> 概念设计
2. 关系模式 -> 逻辑设计
3. 数据字典和数据流图 -> 需求分析

#### 例题3

某数据库中有员工关系E (员工号,姓名，部门，职称，月薪) ;产品关系P (产品号，产品名称，型号，尺寸，颜色) ;仓库关系W (仓库号，仓库名称，地址，负责人) ;库存关系I (仓库号，产品号，产品数量)。
a.若数据库设计中要求:
①仓库关系W中的“负责人”引用员工关系的员工号
②库存关系I中的“仓库号，产品号”唯一标识|中的每一个记录
③员工关系E中的职称为“工程师”的月薪不能低于3500元
则①②③依次要满足的完整性约束是( B ) 。
A 实体完整性、参照完整性、用户定义完整性
B 参照完整性、实体完整性、用户定义完整性
C 用户定义完整性、实体完整性、参照完整性
D 实体完整性、用户定义完整性、参照完整性

b.若需得到每种产品的名称和该产品的总库存量，则对应的查询语句为:
SELECT 产品名称，SUM(产品数量) FROM P，I WHERE P.产品号=I.产品号( C ) ;
A ORDER BY 产品名称
B ORDER BY 产品数量
C GROUP BY 产品名称
D GROUP BY 产品数量

#### 例题4

在数据库逻辑结构的设计中，将E-R模型转换为关系模型应遵循相关原则。对于三个不同实体集和它们之间的多对多联系m: n: p,最少可转换为（ C ）个关系模式。
A. 2	B. 3	C. 4	D. 5

#### 例题5

某企业工程项目管理数据库的部分关系模式如下所示，其中带\*的表示主键，虚下划线的表示外键。
	供应商(供应商号\*，名称，地址，电话，账号)
	项目(项目号\*，负责人\*，开工日期)
	零件(零件号\*，名称，规格，单价)
	供应(项目号\*，零件号\*，供应商号\*，供应量)
	员工(员工号\*，姓名，性别，出生日期，职位，联系方式)
其中供应关系是( D )的联系。若一个工程项目可以有多个员工参加，每个员工可以参加多个项目，则项目和员工之间是( C )联系。对项目和员工关系进行设计时，( A )设计成一个独立的关系模式。
A 2个实体之间的1 : n
B 2个实体之间的n : m
C 3个实体之间的1 : n : m
D 3个实体之间的k : n : m

A 1:1	B 1:n	C n:m	D n:1

A 多对多的联系在向关系模型转换时必须
B 多对多的联系在向关系模型转换时无须
C 只需要将一端的码并入多端，所以无须
D 不仅需要将一端的码并入多端，而且必须

## 关系代数

关系模型中的属性列，属性列的个数称之为N目，表示有多少个属性列。而数据行（元组行/记录），表示一个实例。

关系代数有：并、交、差、笛卡儿积、投影、选择、连接。

### 并、交、差

并、交、差是二元运算，2个相应的二维表运算，这两个二维表是同构的（属性列是完全一致）。

- 并：S1（123）∪ S1（145） = 12345 （可以去重）
- 交：S1（123）∩ S1（145） = 1
- 差：S1（123）- S1（145） = 23

### 笛卡儿积

差是二元运算，2个相应的二维表运算，这两个二维表不要求同构。

笛卡尔积 = S1(abc,123) × S2(aef,456) = Rx(abcaef,123456)：

- 属性目 = 两者的之和，属性名相同以s1.a和s2.a来表示。
- 元组行 = 两者的乘积，2组数据完成拼接。

### 投影

投影是一元运算，是垂直方向上做截取，也就是选择属性列。

投影 = S1(abc,123)π<sub>a,b</sub> = S1(ab,123)

### 选择

选择是一元运算，是水平方向上做截取，也就是选择数据行。

选择 = S1(abc,123)σ<sub>a='1'</sub> = S1(abc,1)

### 连接

⋈自然连接：二者之和去除重复的列，元组行取交集。

S1(abc,123) ⋈ S2(acd,256) = R(abcd,2)

自然连接和笛卡尔积可以存在等值运算，另外自然连接性能由于笛卡尔积。

### 例题

#### 例题1

若关系R、S如下图所示，则关系R与S进行自然连接运算后的元组个数和属性列数分别为( D ) ;关系代数表达式π<sub>1,4</sub>(σ<sub>3=6</sub>(RXS))与关系代数表达式( C )等价。

![image-20220506181309859](https://geforce-tang.oss-cn-shanghai.aliyuncs.com/imgs/image-20220506181309859.png)

A 6和6	B 4和6	C 3和6	D 3和4

A π<sub>A,D</sub> (σ<sub>C=D</sub>(RXS))
B π<sub>A,R.D</sub> (σ<sub>S.C=R.D</sub>(RXS))
C π<sub>A,R.D</sub> (σ<sub>R.C=S.D</sub>(RXS))
D π<sub>A,R.D</sub> (σ<sub>S.C=S.D</sub>(RXS)) 

解题：

1. 自然连接注意是全值匹配，R.C=S.C AND R.D=S.D。图中有3条数据是满足的，注意如果R中的CD不是74而是75则不满足。
2. 另外自然连接是会自动去重的，所以只存在ABCD 4个属性列。

#### 例题2

在关系R (A1, A,, Az) 和S (A2, A3，A)上进行关系运算的4个等价的表达式E1、E2、E3和E4如下所示:
E1=π<sub>A1,A4</sub> (σ<sub>A2<'2018' ∧ A4='95'</sub>(R⋈S))
E2=π<sub>A1,A4</sub> (σ<sub>A2<'2018'</sub>(R) ⋈ σ<sub>A4='95'</sub>(S))
E3=π<sub>A1,A4</sub> (σ<sub>A2<'2018' ∧ R.A3=S.A3 ∧ A4='95'</sub>(RXS))
E4=π<sub>A1,A4</sub> (σ<sub>R.A3=S.A3</sub>(σ<sub>A2<'2018'</sub>)(R)Xσ<sub>A4='95'</sub>(S))
如果严格按照表达式运算顺序执行，则查询效率最高的是表达式( B )。
A E1	B E2	C E3	D E4

#### 例题3

给定关系R(A，B，C，D,E)与S(A,B,C，F,G)，那么与表达式π<sub>1，2, 4, 6，7</sub>(σ<sub>1<6</sub> (R⋈S))等价的SQL语句如下:
SELECT ( B ) FROM R，S WHERE ( C ) ;

A R.A，R.B，R.E， S.C， G
B R.A, R.B, D, F，G
C R.A，R.B，R.D，S.C，F
D R.A， R.B， R.D， S.C， G

A R.A=S.A OR R.B=S.B OR R.C=S.C OR R.A<S.F
B R.A=S.A OR R.B=S.B OR R.C=S.C OR R.A<S.B
C R.A=S.A AND R.B=S.B AND R.C=S.C AND R.A<S.F
D R.A=S.A AND R.B=S.B AND R.C=S.C AND R.A<S.B

解题

1. π<sub>1，2, 4, 6，7</sub>(σ<sub>1<6</sub> (R⋈S))是自然连接，属性列有ABCDEFG，对应12467 = ABDFG
