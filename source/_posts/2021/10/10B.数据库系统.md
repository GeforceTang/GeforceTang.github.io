---
title: 数据库系统
date: 2021-10-17 22:50:25
categories: 架构软考
tags: 架构设计
---


# 知识点
## 知识体系
![知识体系](/images/系统架构师/数据库系统-知识体系.png)

<!--more-->
## 三级模式-两层映射
![三级模式](/images/系统架构师/数据库系统-三级模式.png)
三级模式
1. 内模式：对应物理级别数据库（物理文件）
2. 概念模式：对应数据表结构
3. 外模式：对应视图

两层映射
1. 第一层映射的作用（外模式）：数据库表发生变化应用程序不变（通过视图可以解决表变化后应用程序需要变化的问题）。
2. 第二次映射的作用（内模式）：文件存储发生变化不影响应用程序。

### 视图
![视图](/images/系统架构师/数据库系统-三级模式视图.png)
物化视图：能提高查询性能，但是更新原始表效率会降低。

## 数据库设计过程
![设计过程](/images/系统架构师/数据库系统-设计过程.png)
和软件工程中的冲突：软件工程ER模式是在需求分析阶段的数据建模工具，而数据库设计过程ER模式是在概念结构设计的产物。
需求分析主要产物：数据流图（DFD）、数据字典（DD）、需求说明书

### ER模型
用途：梳理清楚有哪些数据，以及数据之间的关联关系。
![ER模型](/images/系统架构师/数据库系统-设计过程ER模型.png)
![ER模型2](/images/系统架构师/数据库系统-设计过程ER模型2.png)
1. 数据抽象：识别出对象以及其属性（比如说学生）。
2. 局部和合并：逐步设计ER模型，最终合并起来。
3. 重构优化：最新成形ER模型。

#### 转换关系模式
![ER模型3](/images/系统架构师/数据库系统-设计过程ER模型3.png)
无论哪一种都是转换成单独的对应模式。
1. 一对一转换模式：每个实体单独转换成一个关键模式，每个属性对应一个字段。 -> 学生（学号，姓名，性别，年龄）
2. 一对多转换模式：可以单独转换关系模式，也可以连续与N端联系。
3. 多对多转换模式：必须单独转换关系模式

三个以上的实体间转换，多了一个联系。

## 关系代数
![关系代数](/images/系统架构师/数据库系统-关系代数.png)
1. 并集：将S1和S2合并起来，去掉重复记录
2. 交集：S1和S2的公共部分的记录
3. 差集：在S1中但不在S2中的记录
4. 笛卡尔积：S1的记录*S2的记录，逐条连接
5. 投影：获取记录的指定字段（列）
6. 选择：获取满足条件的记录（行）
7. 联接：S1与S2的Join操作，连接的本质是对数据做选择、投影、笛卡尔积。

### 自然连接
对S1与S2中相同的属性做等值连接，去掉重复属性。
![自然连接](/images/系统架构师/数据库系统-关系代数自然连接.png)
比如要筛选Age<22的数据，可以先对S2做选择后，再和S1做笛卡尔积，之后再做投影。

## 规范化理论
用途：在ER模型转换成关系模式之后发现存在的问题，其对应的规范化处理方法。
![规范化理论](/images/系统架构师/数据库系统-规范化理论.png)
把一个低一级的关系模型分解为高一级关系模型的过程，称为关系模型的规范化。关系模型分解必须遵守两个准则。
（1）无损连接性：信息不失真（不增减信息）。
（2）函数依赖保持性：不破坏属性间存在的依赖关系。

规范化的基本思想是逐步消除不合适的函数依赖，使数据库中的各个关系模型达到某种程度的分离。

### 函数依赖
![函数依赖](/images/系统架构师/数据库系统-规范化理论函数依赖.png)
概念是这样的：比如函数标识 y=x² ，当y=1时x=[-1,1]，存在不确定性。
同理到数据库中，比如身份证可以确定姓名，但不能通过姓名来确定身份证。
1. 部分函数依赖：F{AB->D}，AB做为组合主键的情况下又存在F{A->C}的函数依赖，由主键的部分确定依赖则为部分函数依赖。
2. 传递函数依赖：A -> B, B -> C = A -> C

### 键
![键](/images/系统架构师/数据库系统-规范化理论键.png)
1. 候选键：唯一标记的列
2. 主键：在候选键中选择
3. 外键：连接使用

#### 求候选键
![求候选键](/images/系统架构师/数据库系统-规范化理论候选键.png)

### 范式
综合1NF、2NF和3NF、BCNF的内涵可概括如下：
（1）非主属性完全函数依赖于候选码（2NF的要求）；
（2）非主属性不传递依赖于任何一个候选码（3NF的要求）；
（3）主属性对不含它的码完全函数依赖（BCNF的要求）；
（4）没有属性完全函数依赖于一组非主属性（BCNF的要求）。
![范式](/images/系统架构师/数据库系统-规范化理论范式.png)

#### 第一范式
1NF是最低的规范化要求。如果关系R中所有属性的值域都是简单域，其元素（即属性）不可再分，是属性项而不是属性组，那么关系模型 R是第一范式的，记作 R∈1NF。这一限制是关系的基本性质，所以任何关系都必须满足第一范式。第一范式是在实际数据库设计中必须先达到的，通常称为数据元素的结构化。
![第一范式](/images/系统架构师/数据库系统-规范化理论第一范式.png)
1. 简单属性：不可拆分
2. 复合属性：可以再拆分
3. 多指属性：对应多个值，一个字段里面存储了多个数据。（较好的处理方案是新增一个实体）
4. 派生属性：派生出来的数据，可以理解为冗余（比如出生年和年龄）

#### 第二范式
![第二范式](/images/系统架构师/数据库系统-规范化理论第二范式.png)
主属性：被包含于任意一个候选键的属性。
不满足第二范式产生的影响：数据冗余、更新异常、删除异常。

#### 第三范式
![第三范式](/images/系统架构师/数据库系统-规范化理论第三范式.png)


#### BC范式
![BC范式](/images/系统架构师/数据库系统-规范理论BC范式.png)

### 满足范式
![无损分解](/images/系统架构师/数据库系统-规范理论无损分解.png)
1. 保持函数依赖分解：在对表拆分的时候，分析源表的函数依赖关系，在拆分后依旧满足。 比如R(A,B,C)的函数依赖为F={A->B,B->C}，则R拆分为R1(A,B)和R2(B,C)是满足的。
2. 无损分解：无损是可以还原，有损是无法还原。无损分解是指将表拆分后可以还原回来。

#### 无损分解
![无损分解1](/images/系统架构师/数据库系统-规范理论无损分解1.png)
可以使用两种方法解析：表格法、公式法
##### 表格法
![表格法](/images/系统架构师/数据库系统-规范理论无损分解表格法.png)
第一步：构建初始版
第二步：关联打勾
第三步：如果表格完整则说明无损

##### 公式法
![公式法](/images/系统架构师/数据库系统-规范理论无损分解公式法.png)
只能适用于一分为二的场景。

##### 基本原则
![基本原则](/images/系统架构师/数据库系统-规范理论无损分解基本原则.png)
![基本规则](/images/系统架构师/数据库系统-规范理论无损分解基本规则.png)

### 反规范化
![反规范化](/images/系统架构师/数据库系统-反规范化.png)
- 增加派生性冗余列：增加对可以推导出来数据的存储，减少重复计算。
- 增加冗余列：增加冗余的字段减少连接查询。
- 重新组表：通过查询的要求重新组装新表，避免数据查询的复杂度。
- 分割表：<不好理解>。

同样会带来一些问题，比如数据一致性，这种场景往往通过触发器解决，同样效率又有问题。


## 并发控制
![并发控制概念](/images/系统架构师/数据库系统-并发控制概念.png)
- 原子性：原子操作、不可分割，要么全部执行完成要么全部不执行。
- 一致性：在一个事务执行之前和执行之后数据库都必须处于一致性状态。
- 隔离性：每个事务都是独立执行，互相之间不会干扰。
- 持续性：事务处理的结果必须能够得到固化。即写入数据库文件中即使机器宕机数据也不会丢失，它对于系统的影响是永久性的。

### 要解决的问题
![要解决的问题](/images/系统架构师/数据库系统-并发控制要解决的问题.png)
1. 丢失更新：2个事务中更新同一个字段，数据结果不对。比如例子中应该是10-5-8=-3，但实际为2。
2. 不可重复读：同更新丢失的场景，但这个是要求了一次事务的原子性操作。比如例子中T1业务执行过程中的数据，被T2更新了最终导致T1事务执行异常。
3. 读脏数据：2个事务中一个事务更新的无效数据被另外一个事务读取到。比如例子中T1执行失败回滚，但中间数据被T2读取到了。

### 问题解决方案
使用封锁协议解决问题，但同样会引发死锁问题。
![封锁协议](/images/系统架构师/数据库系统-并发控制封锁协议.png)
1. 读锁（S锁）：加了读锁还可以加读锁，但不能加写锁（共享锁）。
2. 写锁（X锁）：加了写锁无法添加其他锁（排它锁）。

### 数据库约束

### 完整性约束
#### 实体完整性约束
主键的设定：唯一性、非空。
#### 参照完整性约束
外键关系：外键有数据时能查询对应的链接数据，否则应为空。
#### 用户自定义完整性约束
自定义规则，比如年龄（0~150）。
#### 触发器
脚本语言实现复杂的操作。

### 安全性约束
![安全性约束](/images/系统架构师/数据库系统-约束安全性.png)

#### 容灾
![容灾](/images/系统架构师/数据库系统-约束安全性容灾.png)
##### 数据备份
![数据备份](/images/系统架构师/数据库系统-约束安全性数据备份.png)
1. 通过对数据库执行：完全备份、差量备份、增量备份实现对数据的恢复处理。
    - 周日 完全备份
    - 周日 -> 周一 增量备份
    - 周一 -> 周二 增量备份
    - 周日 -> 周三 差量备份
2. 通过日志文件的解析，在备份文件的基础上完成日志记录的行为回访执行，完成数据的恢复处理。
日志文件清理可以在完整备份之后再清理。

##### 数据恢复
![数据恢复](/images/系统架构师/数据库系统-约束安全性数据恢复.png)


## 分布式数据库
![分布式数据库](/images/系统架构师/数据库系统-分布式数据库.png)
概念：数据库的内容存储到多个物理节点上，通过DBMS作为一个整体对外提供服务。
1. 全局概念模式：
2. 分片模式（逻辑）：关注哪些表格做了横向的切片。
3. 分布模式（物理）：关注哪些数据库存储在哪些节点上。

### 数据库分表
![分布式数据库2](/images/系统架构师/数据库系统-分布式数据库2.png)

### 数据表分区
![数据表分区](/images/系统架构师/数据库系统-分布式数据库分区.png)

#### 优点
![优点](/images/系统架构师/数据库系统-分布式数据库分区2.png)

#### 策略
![策略](/images/系统架构师/数据库系统-分布式数据库分区策略.png)

## 数据仓库与数据挖掘

### 数据仓库
![数据仓库](/images/系统架构师/数据库系统-数据仓库.png)

## 联邦数据库
![联邦数据库](/images/系统架构师/数据库系统-联邦数据库.png)

## NoSql
![NoSql](/images/系统架构师/数据库系统-NoSql.png)
![NoSql2](/images/系统架构师/数据库系统-NoSql2.png)

## 内存数据库
![内存数据库](/images/系统架构师/数据库系统-内存数据库.png)

## 大数据
![大数据](/images/系统架构师/数据库系统-大数据.png)
由于数据量的不断增长引起量变到质变，从而改变对数据处理的思想、方法、理念、工具产生翻天覆地的变化。
数据库种存在多种技术，实际就是对数据仓库、数据挖掘、NoSql等技术的综合应用。
### 特点
1. 数据量非常庞大
2. 要求处理速度非常快
3. 存在多种多样的数据
4. 体现价值，数据1+1>2的效果

### 处理
![大数据2](/images/系统架构师/数据库系统-大数据2.png)


# 综合实战
## 讲义题目
### 题目（1）
• SQL语言支持关系数据库的三级模式结构图如下所示，图中视图、基本表、存储文件分别对应（ 1 ）。
![第1题](/images/系统架构师/数据库系统-第1题.png)
A. 模式、内模式、外模式
B. 外模式、模式、内模式
C. 模式、外模式、内模式
D. 外模式、内模式、模式


### 题目（2）
• 在数据库设计的需求分析阶段应完成包括（ 2 ）在内的文挡。
A. E-R图 
B. 关系模式
C. 数据字典和数据流图 
D. 任务书和设计方案

### 题目（3）
• 设有职务工资关系 P（职务，最低工资，最高工资），员工关系 EMP（员工号，职务，工资），要求任何一名员工，其工资值必须在其职务对应的工资范围之内，实现该需求的方法是（ 3 ）。
A. 建立“EMP.职务”向“P.职务”的参照完整性约束
B. 建立“P.职务”向“EMP.职务”的参照完整性约束
C. 建立EMP上的触发器程序审定该需求
D. 建立P上的触发器程序审定该需求

### 题目（4）（5）
 • 某数据库中有员工关系 E（员工号，姓名，部门，职称，月薪）；产品关系 P（产品号，产品名称，型号，尺寸，颜色）；仓库关系 W（仓库号，仓库名称，地址，负责人）；库存关系 I（仓库号，产品号，产品数量）。若数据库设计中要求：
    ①仓库关系W中的“负责人”引用员工关系的员工号
    ②库存关系I中的“仓库号，产品号”惟一标识 中的每一个记录
    ③员工关系E中的职称为“工程师”的月薪不能低于 3500 元
    则①②③依次要满足的完整性约束是（ 4 ）。
<br/>若需得到每种产品的名称和该产品的总库存量，则对应的查询语句为：`SELECT 产品名称,SUM(产品数量) FROM P,I WHERE P.产品号＝ I.产品号（ 5 ）; `
(4) 
A. 实体完整性、参照完整性、用户定义完整性
B. 参照完整性、实体完整性、用户定义完整性
C. 用户定义完整性、实体完整性、参照完整性
D. 实体完整性、用户定义完整性、参照完整性
(5) A. ORDERBY 产品名称     B. ORDERBY 产品数量     C. GROUPBY 产品名称     D. GROUPBY 产品数量

#### 解析
- 实体完整性：主键的设定，比如唯一性、非空。
- 参考完整性：外键有数据时能查询对应的链接数据，否则应为空。
- 用户定义完整性：自定义规则，比如年龄（0~150）。

### 题目（6）
• 给定学生S（学号，姓名，年龄，入学时间，联系方式）和选课SC（学号，课程号，成绩）关系，若要查询选修了 1 号课程的学生学号、姓名和成绩，则该查询与关系代数表达式（ 6 ）等价。
![第6题](/images/系统架构师/数据库系统-第6题.png)

### 题目（7）（8）
• 在数据库设计的需求分析阶段应当形成（ 7 ），这些文档可以作为（ 8 ）阶段的设计依据。
(7) 
A. 需求说明文档、数据字典和数据流图
B. 需求说明文档、程序文档和数据流图
C. 程序文档、数据字典和数据流图
D. 需求说明文档、数据字典和程序文档
(8) A. 逻辑结构设计     B. 物理结构设计     C. 概念结构设计     D. 数据库运行和维护

### 题目（9）
• 若要使某用户只能查询表 EMP 中的部分记录，应采取的策略是（ 9 ）。
A. 将该用户级别设定为 DBA
B. 将表 EMP 的查询权限赋予该用户
C. 编写查询表 EMP 的存储过程
D. 构建该部分记录的行级视图，并将该视图的查询权限赋予该用户

### 题目（10）（11）
• 假设关系模式 R(U, F)，属性集 U={A, B, C)，函数依赖集 F={A->B, B->C)。若将其分解为 p={R1(U1, F1), R2(U2, F2))，其中 U1 ={A, B) , U2={A, C}。那么，关系模式R、R1、R2分别达到了（ 10 ）；分解p（ 11 ）。
(10) A. 1NF 2NF 3NF     B. 1NF 3NF 3NF      C. 2NF 2NF 3NF      D. 2NF 3NF 3NF
(11) 
A. 有损连接但保持函数依赖
B. 既无损连接又保持函数依赖
C. 有损连接且不保持函数依赖
D. 无损连接但不保持函数依赖

### 题目（12）
• 在数据库系统中，数据的完整性是指数据的（ 12 ）。
A. 有效性、正确性和一致性 
B. 有效性、正确性和可维护性
C. 有效性、正确性和安全性 
D. 正确性、一致性和安全性

### 题目（13）（14）（15）（16）
• 某公司的商品（商品号，商品名称，生产商，单价）和仓库（仓库号，地址，电话，商品号，库存量）两个实体之间的关系如表1和表2所示。
![第13题](/images/系统架构师/数据库系统-第13题.png)
![第14题](/images/系统架构师/数据库系统-第14题.png)
商品关系的主键是（ 13 ）；仓库关系的主键是（ 14 ）；仓库关系（ 15 ），为了解决这一问题，需要将仓库关系分解为（ 16 ）。
(13) A. 商品号      B. 商品名称     C. 生产商       D. 单价
(14) A. 仓库号,地址        B. 仓库号,电话     C. 仓库号,商品号       D. 地址,电话
(l5) 
A. 无冗余、无插入异常，但存在删除异常 
B. 无冗余，但存在插入异常和删除异常
C. 存在冗余，但不存在修改操作的不一致
D. 存在冗余、修改操作的不一致，以及插入异常和删除异常
(16) 
A. 仓库1（仓库号，地址）和仓库2（仓库号，电话，商品号，库存量）
B. 仓库1（仓库号，地址，电话）和仓库2（商品号，库存量）
C. 仓库1（仓库号，电话）和仓库2（仓库号，地址，商品号，库存量）
D. 仓库1（仓库号，地址，电话）和仓库2（仓库号，商品号，库存量）

### 题目（17）
• 数据仓库在收集数据过程中，会遇到一些略微不一致但可以纠正的数据，纠正的过程称为（ 17 ）。
A. 数据转换     B. 数据抽取     C. 数据清洗     D. 数据装载

### 题目（18）
• 在数据库设计的需求分析阶段，业务流程一般采用（ 18 ）表示。
A. 数据流图     B. E-R      C. 程序结构图       D. 功能模块图

### 题目（19）
• 以下关于 RDBMS 数据分布的叙述中，错误的是（ 19 ）。
A. 数据垂直分割是将不同表的数据存储到不同的服务器上
B. 数据水平分割是将不同行的数据存储到不同的服务器上
C. 数据复制是将数据的多个副本存储到不同的服务器上
D. 数据复制中由 RDBMS 维护数据的一致性

### 题目（20）（21）
• 企业战略数据模型可分为两种类型：（ 20 ）描述日常事务处理中的数据及其关系；（ 21 ）描述企业管理决策者所需信息及其关系。
(20) A. 元数据模型      B. 数据库模型       C. 数据仓库模型     D. 组织架构模型
(21) A. 元数据模型      B. 数据库模型       C. 数据仓库模型     D. 组织架构模型


## 参考答案
![参考答案](/images/系统架构师/数据库系统-参考答案.png)